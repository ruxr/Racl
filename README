
	@(#) README V3.0 © 2024 by Roman Oreshikov

	Пакет скриптов для управления ACL на МСЭ

### Назначение:

	Из конфигурационных файлов построить комплект ACL в формате загрузки для
МСЭ на оборудование Cisco с IOS и сформировать HTML-отчет по использованию МСЭ,
ACL и сетевых объектов, сформированных правил доступа и соответствующих им
обоснований

### Состав:

README		- этот файл
Makefile	- сценарий выполнения работ по управлению ACL
Racl.cfg	- примерный конфигурационный файл для построения ACL
Racl		- скрипт построения эталонных ACL из конфигурационных файлов
Cisco2Racl	- скрипт получения ACL из сохраненной конфигурации МСЭ
Racl2Cisco	- скрипт конвертации эталонных ACL в формат загрузки для МСЭ
Rsh		- скрипт эмуляции доступа к МСЭ по протоколу RSH
Racl.tst	- сценарий автотестирования
Rchk		- скрипт выполнения автотестирования
Racl.local.cfg	- примерный конфиг-файл ЛВС без выхода в Интернет
Racl.inet1.cfg	- примерный конфиг-файл ЛВС с выходом в Интернет (inspect)
Racl.inet2.cfg	- примерный конфиг-файл ЛВС с выходом в Интернет (reflect)

### Использование Makefile:

$ make [target], где target одна из следущих целей:
acl     - Проверить активные ACL на соответствие эталонным (по умолчанию)
actual  - Получить активные ACL из сохраненных конфигураций МСЭ
check   - Проверить наличие необходимых каталогов
clean   - Удалить временные файлы/каталоги
config  - Получить текущие конфигурации МСЭ
diff    - Вывести различия активных ACL с вновь построенными
dist    - Создать дистрибутивный архив Racl
install - Загрузить эталонные ACL на соответствующие МСЭ
help    - Вывести справку по целям
report  - Получить HTML-отчёт
test    - Выполнить автотест работоспособности

### Использование  Cisco2Racl:

$ Cisco2Racl file, где:
	file    - имя файла конфигурации устройства Cisco

	Скрипт Cisco2Racl производит выборку расширенных ACL из сохранённого
файла конфигурации Cisco на стандартный вывод, преобразуя их имена под
требования Racl и выполняя замену именованных портов на соответствующее им
цифровые значения.

### Использование Racl2Cisco:

$ Racl2Cisco -d DIR src dst, где
	DIR	- каталог для записи измененных ACL 
	src	- файл Racl с актуальными ACL (созданный Cisco2Racl)
	dst	- файл Racl с эталонными ACL (созданный Racl)

	Скрипт Racl2Cisco сранивает актуальные и эталонные ACL и если есть
отличия, то сообщает об этом и формирует файл с эталонным ACL для МСЭ в каталоге
DIR в формате загрузки для устройств Cisco. Дополнительно, скрипт производит
оптимизацию файла с актуальными ACL, для исключения неоднозначности.

### Использование Rsh:

$ Rsh IP cmd, где
	IP	- IP адрес МСЭ
	cmd     - одна из двух команд:
		1. show running-config
		2. copy tftp://host/path/file running-config
	
	Скрипт Rsh предназначен для демонстрации работы с МСЭ и для 1-й команды
выводит предопределенную конфигурацию МСЭ на стандартный вывод, а по 2-й команде
успешно завершается.

### Использование Rchk:

$ Rchk -l log -r prg [-t dir] tst, где
	log	- имя файла для протокола тестирования
	prg	- тестируемая программа
	dir	- каталог для временных файлов создаваемых при тестировании
	tst	- shell-сценарий тестирования

	Скрипт Rchk выводит на стандартный вывод ход тестирования, а в указанный
файл полный протокол тестирования в соответствии с заданным сценарием.

### Использование Racl:

Racl [-n] [-o] [-l LST] [-r HTM] file [file ...], где
	-n	- флаг запрета вывода эталонных ACL
	-o	- флаг выполнения оптимизации ACL
	LST	- имя файла для записи списка МСЭ
	HTM	- имя файла для записи HTML-отчёта
	file	- имя конфигурационного файла

	Основной скрипт Racl в соответствии с описанием сетевой инфраструктуры,
обоснований и соответствующих им правил доступа, описанных конфигурационными
файлами, строит эталонные ACL, список задействованных МСЭ и формирует суммарный
HTML-отчет. ACL выводятся на стандартный выход, список и отчёт в соответствующие
файлы.
 
### Формат конфигурационного файла Racl:

Пустая строка или начинающаяся с символа "#" - игнорируется
Если последний символ строки "\", то следующая строка - продолжение текущей

1. Регистрация МСЭ и группы МСЭ
  dev DevName IP DNS
  DEV DevName DevName ...
	DevName	- уникальное имя МСЭ (группы МСЭ)
 	IP	- IPv4 адрес доступа к МСЭ
	DNS	- DNS  имя МСЭ

2. Регистрация ACL для входящего локального и внешнего трафика
  acl AclName DevName Desc
  ACL AclName DevName Desc
	AclName	- уникальное имя ACL, не совпадающее с именами МСЭ
 	DevName	- имя МСЭ (группы МСЭ) где присутствует ACL
	Desc	- описание ACL

3. Регистрация сетевого объекта
  add IP -|AclName Desc
	IP	- IPv4 адрес (IPv4 сеть в формате ip/mask) объекта
	-	- зарезервированный за ЛВС объект
 	AclName	- имя ACL контролирующего входящий трафик от объекта
	Desc	- описание объекта

4. Регистрация группы локальных и внешних сетевых объектов
  grp GrpName IP|GrpName ... [- IP|GrpName ...]
  GRP GrpName IP|GrpName ... [- IP|GrpName ...]
	GrpName	- уникальное имя группы не сопадающее с именами МСЭ или ACL
	IP	- IPv4 адрес (IPv4 сеть в формате ip/mask) объекта
	-	- флаг исключения последующих объектов из группы
  Примечание:
		Автоматически создаются группы с соответствующими именами из
	объявлений МСЭ (групп МСЭ) и ACL, где группа с именем МСЭ содержит
	его IP адрес, с именем группы МСЭ - IP адреса МСЭ входящих в неё, а
	с именем ACL - список обслуживаемых им сетевых объектов
		Специальные группы:
	any - включает все возможные сетевые объекты (суперсеть 0/0)
	*   - содержит список всех активных локальных сетевых объектов

5. Регистрация описание сетевого объекта
  def IP Desc
	IP	- IPv4 адрес (IPv4 сеть в формате ip/mask) объекта
	Desc	- описание объекта (обычно DNS-имя)

6. Регистрация обоснования для последующих правил доступа
  new Order
	Order	- название обоснования
  Примечание:
	Первое обоснование, до регистрации МСЭ, является заголовком HTML-отчёта

7. Регистрация описания для последующих правил доступа
  ; Desc
	Desc	- описание назначения

8. Регистрация правила доступа
  enable|disable Proto IP|GrpName [From] IP|GrpName [To] [Opt]
	Proto == ip|icmp|tcp|udp|ospf|eigrp
	From|To (tcp|udp) == {eq|gt|lt|neg Port}|{range Port Port}
	Port == 0-65535
	To (icmp) == echo|echo-reply|ttl-exceeded|packet-too-big|unreachable
	Opt == {reflect Name [log]}|log

9. Регистрация/добавление содержания к обоснованию
  Text 
	Text	- текст содержания

### Использование правил доступа:

	Если регистрируется правило разрешения обращения из локальной сети к
внешнему сетевому объекту, составной частью которого являются какие-либо
локальные сетевые объекты, то автоматически создаются правила для ACL источника
запрета обращения к последним
	Если регистрируется правило разрешения обращения от внешних сетевых
объектов к локальной сети, где какие-либо локальные сетевые объекты являются
составной частью объекта-источника, то для ACL источника автоматически
формируются правила запрета доступа извне с адресами локальных сетевых объектов

### Формат списка МСЭ (сортировка по имени):

name IP

### Формируемый HTML-отчет:

1. Используемые МСЭ
	+-+---+--+---+-------+
	|№|МСЭ|IP|ACL|DNS имя|
	+-+---+--+---+-------+
2. Используемые ACL
	+-+---+---+---+----+------------+
	|№|ACL|Тип|МСЭ|Сеть|Описание ACL|
	+-+---+---+---+----+------------+
3. Используемые сетевые объекты
	+-+--------+---+--------+
	|№|IP адрес|ACL|Описание|
	+-+--------+---+--------+
4. Правила ACL
	+-+-----------+----------+-------+----------+----+
	|№| Источник  | Приемник |Правило|Назначение|  № |
	| |(инициатор)|(ответчик)|  ACL  | правила  |осн.|
	+-+-----------+----------+-------+----------+----+
5. Обоснования
	+-+--------+----------+
	|№|Название|Содержание|
	+-+--------+----------+
