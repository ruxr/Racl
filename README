
	@(#) README V5.1 © 2024 by Roman Oreshikov

	Пакет скриптов для управления ACL на МСЭ

### Назначение:

	Из конфигурационных файлов построить комплект ACL в формате загрузки для
МСЭ на оборудование Cisco с IOS и сформировать HTML-отчет по использованию МСЭ,
ACL и IP-адресов, сформированных правил доступа и соответствующих им обоснований

### Состав:

README		- этот файл
Makefile	- сценарий выполнения работ по управлению ACL
Racl.cfg	- примерный конфигурационный файл для построения ACL
Racl		- скрипт построения эталонных ACL из конфигурационных файлов
Cisco2Racl	- скрипт получения ACL из сохраненной конфигурации МСЭ
Racl2Cisco	- скрипт конвертации эталонных ACL в формат загрузки для МСЭ
Rsh		- скрипт эмуляции доступа к МСЭ по протоколу RSH
Racl.tst	- сценарий автотестирования
Rchk		- скрипт выполнения автотестирования
Racl.local.cfg	- примерный конфиг-файл ЛВС без выхода в Интернет
Racl.inet1.cfg	- примерный конфиг-файл ЛВС с выходом в Интернет (inspect)
Racl.inet2.cfg	- примерный конфиг-файл ЛВС с выходом в Интернет (reflect)

### Использование Makefile:

$ make [target], где target одна из следущих целей:
acl     - Проверить активные ACL на соответствие эталонным (по умолчанию)
actual  - Получить активные ACL из сохраненных конфигураций МСЭ
check   - Проверить наличие необходимых каталогов
clean   - Удалить временные файлы/каталоги
config  - Получить текущие конфигурации МСЭ
diff    - Вывести различия активных ACL с вновь построенными
dist    - Создать дистрибутивный архив Racl
install - Загрузить эталонные ACL на соответствующие МСЭ
help    - Вывести справку по целям
report  - Получить HTML-отчёт
test    - Выполнить автотест работоспособности

	Для промышленной эксплуатации в Makefile необходимо переопределить
основные переменные:
  WRK	- рабочий каталог пакета (read-write)
  CFG	- список конфигурационных файлов в порядке обработки (readonly)
  HTM	- имя файла отчета (write)
  ADM	- IP-адрес TFTP-сервера для доступа с МСЭ
  CMD	- команда взаимодействия с МСЭ
  DST	- каталог загрузочных файлов ACL для МСЭ (write)
  NEW	- имя каталога DST в иерархии TFTP-сервера
  SRC	- каталог конфигурационных файлов МСЭ (readonly)

### Использование  Cisco2Racl:

$ Cisco2Racl file, где:
	file    - имя файла конфигурации устройства Cisco

	Скрипт Cisco2Racl производит выборку расширенных ACL из сохранённого
файла конфигурации Cisco на стандартный вывод, преобразуя их имена под
требования Racl и выполняя замену именованных портов на соответствующее им
цифровые значения.

### Использование Racl2Cisco:

$ Racl2Cisco -d DIR src dst, где
	DIR	- каталог для записи измененных ACL 
	src	- файл Racl с актуальными ACL (созданный Cisco2Racl)
	dst	- файл Racl с эталонными ACL (созданный Racl)

	Скрипт Racl2Cisco сранивает актуальные и эталонные ACL и если есть
отличия, то сообщает об этом и формирует файл с эталонным ACL для МСЭ в каталоге
DIR в формате загрузки для устройств Cisco. Дополнительно, скрипт производит
оптимизацию файла с актуальными ACL, для исключения неоднозначности.

### Использование Rsh:

$ Rsh IP cmd, где
	IP	- IP адрес МСЭ
	cmd     - одна из двух команд:
		1. show running-config
		2. copy tftp://host/path/file running-config
	
	Скрипт Rsh предназначен для демонстрации работы с МСЭ и для 1-й команды
выводит предопределенную конфигурацию МСЭ на стандартный вывод, а по 2-й команде
успешно завершается.

### Использование Rchk:

$ Rchk -l log -r prg [-t dir] tst, где
	log	- имя файла для протокола тестирования
	prg	- тестируемая программа
	dir	- каталог для временных файлов создаваемых при тестировании
	tst	- shell-сценарий тестирования

	Скрипт Rchk выводит на стандартный вывод ход тестирования, а в указанный
файл полный протокол тестирования в соответствии с заданным сценарием.

### Использование Racl:

Racl [-n] [-o] [-l LST] [-r HTM] file [file ...], где
	-n	- флаг запрета вывода эталонных ACL
	-o	- флаг выполнения оптимизации ACL
	LST	- имя файла для записи списка МСЭ
	HTM	- имя файла для записи HTML-отчёта
	file	- имя конфигурационного файла

	Основной скрипт Racl в соответствии с описанием сетевой инфраструктуры,
обоснований и соответствующих им правил доступа, описанных конфигурационными
файлами, строит эталонные ACL, список задействованных МСЭ и формирует суммарный
HTML-отчет. ACL выводятся на стандартный выход, список и отчёт в соответствующие
файлы.
 
### Формат конфигурационного файла Racl:

Пустая строка или начинающаяся с символа "#" - игнорируется
Если последний символ строки "\", то следующая строка - продолжение текущей

!!!Важен порядок значимых строк

1. Заголовок отчёта
  Header
	Header	- строка заголовка

2. Блок регистрации используемых IP-адресов
  IP Acl|- Desc
	IP	- IPv4 адрес (сеть в формате ip/mask)
	Acl	- имя ACL контролирующего входящий трафик
	-	- зарезервированный за ЛВС IP-адрес
	Desc	- описание сети (DNS-имя интерфейса)

3. Блок регистрации IP-адресов управления МСЭ
  Dev (IP)+
	Dev	- уникальное имя МСЭ (группы МСЭ)
	IP	- IPv4 адрес управления МСЭ

4. Блок регистрации ACL
  +|- Acl Dev Desc
	+	- ACL входящего в ЛВС трафика
	-	- ACL исходящего из ЛВС трафика
	Acl	- уникальное имя ACL
	Dev	- имя МСЭ (группы МСЭ) использующих ACL
	Desc	- описание ACL

5. Регистрация обоснования для последующих правил доступа
  Order
	Order	- строка название обоснования

6. Регистрация содержания текущего обоснования
  Content
	Content	- одна и более строк содержание обоснования

7. Именование используемых IP-адресов
  IP Desc
	IP	- IPv4 адрес или IPv4 сеть в формате ip/mask
	Desc	- описание (обычно DNS-имя)

8. Регистрация группы IP-адресов для последующих правил доступа
  Group (IP|Group)+
	Group	- уникальное имя группы
	IP	- IPv4 адрес (IPv4 сеть в формате ip/mask)

9. Регистрация описания для последующих правил доступа
  ; Desc
	Desc	- описание назначения

10. Регистрация правила доступа
  [Acl] [Num] pass|drop Proto Src [From] Dst [To] [Opt]
	Acl	- имя ACL для которого предназначено правило
	Num	- целое число определяющее позицию правила в ACL
	Proto	- протокол
	Src	- источник трафика
	Dst	- приёмник трафика
	From	- порт источника
	To	- порт приемника
	Opt	- дополнение правила
  Примечание:
	Proto == ip|icmp|tcp|udp|ospf|eigrp
	Src|Dst == IP|Group|any|*
	From|To (tcp|udp) == (eq|gt|lt|neg Port)|(range Port Port)
	Port == 0-65535
	To (icmp) == echo|echo-reply|ttl-exceeded|packet-too-big|unreachable
	Opt == (reflect NewAcl)|log
	Opt (tcp) == established
  Специальные имена:
	any - включает все возможные IP-адреса (суперсеть 0/0)
	*   - содержит все локальные сети
  Умолчательные позиции для правил:
	5	- evaluate ACL
	10	- блокировка доступа извне с локальными IP
	25	- внутрисетевое взаимодействие
	50	- блокировка доступа из сегмента к локальным IP
	75	- взаимодействие ЛВС с внешним IP или извне с ЛВС

### Использование правил доступа:

	Если регистрируется правило разрешения обращения из локальной сети к
внешнему IP-адресу, составной частью которого являются какие-либо локальные
IP-адреса, то автоматически создаются правила для запрета обращения к последним
в ACL источника
	Если регистрируется правило разрешения обращения от внешних IP-адресов
к локальной сети, где какие-либо локальные IP-адреса являются составной частью
IP-адреса источника, то для ACL источника автоматически формируются правила
запрета доступа извне с локальными IP-адресами

### Формат списка МСЭ (сортировка по DNS-имени):

IP DNS-имя

### Формируемый HTML-отчет:

Заголовок из конфигурации

1. Используемые МСЭ
╔═╤═══════╤══╤═══╗
║№│DNS-имя│IP│ACL║
╚═╧═══════╧══╧═══╝
2. Используемые ACL
╔═╤═══╤═══╤═══╤══╤════════╗
║№│ACL│Тип│МСЭ│IP│Описание║
╚═╧═══╧═══╧═══╧══╧════════╝
3. Используемые IP-адреса
╔═╤══╤═══╤════════╗
║№│IP│ACL│Описание║
╚═╧══╧═══╧════════╝
4. Правила ACL
╔═╤═══════════╤══════════╤═══════╤══════════╤═══╗
║№│ Источник  │ Приемник │Правило│Назначение│ № ║
║ │(инициатор)│(ответчик)│  ACL  │ правила  │осн║
╚═╧═══════════╧══════════╧═══════╧══════════╧═══╝
5. Обоснования
╔═╤════════════╤══════════╗
║№│Наименование│Содержание║
╚═╧════════════╧══════════╝
